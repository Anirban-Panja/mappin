<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Accelerometer Calibration and Data</title>
<style>
    body {
        font-family: Arial, sans-serif;
        text-align: center;
    }
    #output {
        margin-top: 20px;
    }
</style>
</head>
<body>
<h1>Accelerometer Calibration and Data</h1>
<div id="output">
    <p id="accelerationXDisplay">Acceleration along the X-axis: <span id="accelerationX">0</span></p>
    <p id="accelerationYDisplay">Acceleration along the Y-axis: <span id="accelerationY">0</span></p>
    <p id="calibrationTimer">Calibration time remaining: <span id="calibrationTime">10</span> seconds</p>
    <button id="calibrationButton">Calibrate</button>
    <h2>Gyroscope Data</h2>
    <p id="gyroscopeXDisplay">Angular velocity along the X-axis: <span id="gyroscopeX">0</span></p>
    <p id="gyroscopeYDisplay">Angular velocity along the Y-axis: <span id="gyroscopeY">0</span></p>
</div>

<script>
    if ('Accelerometer' in window && 'Gyroscope' in window) {
        const acl = new Accelerometer({ frequency: 60 });
        const gyroscope = new Gyroscope({ frequency: 60 });
        let calibrationData = [];
        let calibrationDuration = 10000; // Calibration duration in milliseconds (10 seconds)
        let calibrationCompleted = false;
        let offsetX = 0;
        let offsetY = 0;

        // Function to start calibration
        function startCalibration() {
            calibrationData = [];
            calibrationCompleted = false;
            offsetX = 0;
            offsetY = 0;
            let calibrationTimeRemaining = calibrationDuration / 1000;
            let calibrationTimerInterval = setInterval(() => {
                calibrationTimeRemaining--;
                document.getElementById("calibrationTime").textContent = calibrationTimeRemaining;
                if (calibrationTimeRemaining <= 0) {
                    clearInterval(calibrationTimerInterval);
                }
            }, 1000);

            // Start calibration phase
            setTimeout(() => {
                if (calibrationData.length > 0) {
                    // Calculate offset as the average of calibration data
                    let sumX = calibrationData.reduce((acc, curr) => acc + curr.x, 0);
                    let sumY = calibrationData.reduce((acc, curr) => acc + curr.y, 0);
                    offsetX = sumX / calibrationData.length;
                    offsetY = sumY / calibrationData.length;

                    calibrationCompleted = true;

                    // Display calibration results
                    console.log('Calibration complete.');
                    console.log('Offset X:', offsetX);
                    console.log('Offset Y:', offsetY);
                } else {
                    console.error('No data collected for calibration.');
                }
            }, calibrationDuration);
        }

        // Event listener for calibration button click
        document.getElementById("calibrationButton").addEventListener("click", startCalibration);

        acl.addEventListener("reading", function() {
            if (!calibrationCompleted) {
                calibrationData.push({ x: acl.x, y: acl.y });
            } else {
                // Apply calibration by subtracting offset
                let calibratedX = acl.x - offsetX;
                let calibratedY = acl.y - offsetY;

                // Display calibrated values
                document.getElementById("accelerationX").textContent = calibratedX.toFixed(2);
                document.getElementById("accelerationY").textContent = calibratedY.toFixed(2);
            }
        });

        gyroscope.addEventListener("reading", function() {
            // Display gyroscope values
            document.getElementById("gyroscopeX").textContent = gyroscope.x.toFixed(2);
            document.getElementById("gyroscopeY").textContent = gyroscope.y.toFixed(2);
        });

        acl.start();
        gyroscope.start();
    } else {
        console.error('Accelerometer or Gyroscope not supported.');
    }
</script>
</body>
</html>
